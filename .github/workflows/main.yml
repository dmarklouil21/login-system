name: Full Stack CI Pipeline

on: [push, pull_request]

jobs:
  # -------------------------------
  # FRONTEND JOBS (React)
  # -------------------------------
  frontend-install:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./frontend
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json
      - name: Install Frontend
        run: npm ci

  frontend-test:
    needs: frontend-install
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./frontend
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      - name: Install Frontend
        run: npm ci
      # 1. Check for messy code
      - name: Frontend Lint
        run: npm run lint
      # 2. Check if it builds
      - name: Frontend Build
        run: npm run build
        env:
          VITE_API_URL: ${{ vars.VITE_API_URL }}

  # -------------------------------
  # BACKEND JOBS (Node/Express)
  # -------------------------------
  backend-check:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./backend
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: backend/package-lock.json
      
      # 1. Does the backend install correctly?
      - name: Install Backend
        run: npm ci

      # 2. OPTIONAL: Run tests if you have them
      # If you haven't written tests (Jest/Mocha), DELETE this step or it will fail!
      # - name: Run Backend Tests
      #   run: npm test
